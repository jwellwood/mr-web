#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run ESLint and auto-fix issues
echo "ğŸ“ Linting and fixing code..."
npm run lint-fix

# Stage any auto-fixed files
git add -u

# Run tests with coverage
echo "ğŸ§ª Running tests with coverage checks..."
npm run test:coverage

# Run codegen
echo "ğŸ”§ Running GraphQL codegen..."
npm run codegen

# Stage generated files so the commit includes the latest outputs
git add -A

if [ -n "$(git status --porcelain)" ]; then
  echo "âœ… Codegen ran and changes were staged. Commit will include generated files."
fi

echo "âœ… Pre-commit checks passed!"
